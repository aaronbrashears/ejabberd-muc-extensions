# *FIX: Write a macro which figures this out.
# To configure on debian: ./confiugre --prefix /usr
# To configure on macports: ./configure --prefix /opt/local

EJABBERD_EBIN=$(DESTDIR)@prefix@/lib/ejabberd/ebin
ERLC=@ERLC@
ERLCFLAGS=@ERLCFLAGS@


INCLUDE=include
SOURCES=$(wildcard src/*.erl)
OUTDIR=ebin

BEAMS = $(addprefix $(OUTDIR)/,$(notdir $(SOURCES:.erl=.beam)))

.PHONY: all build install clean emake

all: build

build: $(BEAMS) $(OUTDIR)

$(OUTDIR):
	mkdir -p $(OUTDIR)

$(OUTDIR)/%.beam: src/%.erl $(OUTDIR)
	$(ERLC) $(ERLCFLAGS) -I $(INCLUDE) -o $(OUTDIR) $<

install: build
	mkdir -p $(EJABBERD_EBIN)
	cp $(BEAMS) $(EJABBERD_EBIN)

clean:
	rm -f $(BEAMS)

emake:
	$(ERLC) -make
